window.__require=function e(t,o,n){function i(a,s){if(!o[a]){if(!t[a]){var c=a.split("/");if(c=c[c.length-1],!t[c]){var m="function"==typeof __require&&__require;if(!s&&m)return m(c,!0);if(r)return r(c,!0);throw new Error("Cannot find module '"+a+"'")}}var u=o[a]={exports:{}};t[a][0].call(u.exports,function(e){return i(t[a][1][e]||e)},u,u.exports,e,t,o,n)}return o[a].exports}for(var r="function"==typeof __require&&__require,a=0;a<n.length;a++)i(n[a]);return i}({TVManager:[function(require,module,exports){"use strict";cc._RF.push(module,"fc935y12jBIQ4OZvkCLBg9z","TVManager");var CommonVar=require("commonvar");cc.Class({extends:cc.Component,properties:{websocketentity:null,confirm:cc.Button,roomnumber:"",waittime:0,setroommode:!1,startgame:!1,inputroomnum:{default:null,type:cc.EditBox},InputGroup:{default:null,type:cc.Node},ewmSprite:{default:null,type:cc.Sprite},litttletxSprite:{default:[],type:[cc.Sprite]},onlineusernumsTexture:{default:[],type:[cc.SpriteFrame]},onlineusernumSprite:{default:null,type:cc.Sprite},UserGrid:{default:[],type:[cc.Node]},daojishiTextures:{default:[],type:[cc.SpriteFrame]},daojishiSprite:{default:null,type:cc.Sprite}},start:function(){window.tvmanager=this,this.ewmSprite.node.active=!1,this.daojishiSprite.node.active=!1,this.startgame=!1,null==window.localStorage.getItem("roomNum")&&alert("\u7b2c\u4e00\u6b21\u8fdb\u5165\uff0c\u8bf7\u8bbe\u7f6e\u623f\u95f4\u53f7")},onBtnLeftClicked:function(){this.getEWMByRoomNum(this.inputroomnum.string)},setQRCode:function(e){this.InputGroup.active=!1,this.ewmSprite.node.active=!0;var t="data:image/jpeg;base64,"+e,o=new Image;o.src=t;var n=new cc.Texture2D;n.initWithElement(o),n.handleLoadedTexture(),this.ewmSprite.spriteFrame=new cc.SpriteFrame(n);var i={userName:"tv"};i.roomNum=this.roomnumber,i.userType="tv",CommonVar.sendTVLoginData(i,this.ConnectWebSocket)},getUserCountByRoomComplete:function(e){console.log("\u83b7\u53d6\u5f53\u524d\u623f\u95f4\u7528\u6237\u6570\u6210\u529f\uff0c\u7528\u6237\u6570\u4e3a\uff1a"+e),parseInt(e)<2&&(window.tvmanager.unschedule(window.tvmanager.jishifunction),window.tvmanager.startgame=!1,window.tvmanager.daojishiSprite.node.active=!1,console.log("\u7528\u6237\u6570\u592a\u5c11")),window.tvmanager.setlittlttx(e)},setlittlttx:function(e){for(var t=parseInt(e),o=0;o<this.litttletxSprite.length;o++)this.litttletxSprite[o].node.active=o<t;this.onlineusernumSprite.spriteFrame=this.onlineusernumsTexture[t-1]},getEWMByRoomNum:function(e){this.roomnumber=e;var t={url:""};t.url=CommonVar.basePath+"/JavaWebSocket/html/websocket.html?roomNum="+e;var o=CommonVar.basePath+"/JavaWebSocket/qrCode/getqrCode.mvc",n=new XMLHttpRequest;n.open("POST",o,!0),n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){var e=n.responseText;console.log(e),window.tvmanager.setQRCode(e)}},n.setRequestHeader("content-type","application/json"),n.send(JSON.stringify(t))},addUser:function(e){if("tv"!=e.userType){CommonVar.UserList.push(e);for(var t=0;t<this.UserGrid.length;t++)if(null==this.UserGrid[t].getComponent("User").userObject){this.UserGrid[t].getComponent("User").setUserInfo(e);break}}},removeUser:function(e){for(var t=0;t<this.UserGrid.length;t++)null!=this.UserGrid[t].getComponent("User").userObject&&this.UserGrid[t].getComponent("User").userObject.userName==e.userName&&this.UserGrid[t].getComponent("User").removeUserInfo();for(t=0;t<CommonVar.UserList.length;t++)if(CommonVar.UserList[t].userName==e.userName){CommonVar.UserList.splice(t,1);break}},ConnectWebSocket:function ConnectWebSocket(udata){"WebSocket"in window?window.tvmanager.websocketentity=new WebSocket("ws://"+CommonVar.websocketbasePath+"/JavaWebSocket/websocket/"+udata.roomNum+"|"+udata.userName):alert("\u5f53\u524d\u6d4f\u89c8\u5668 Not support websocket"),window.tvmanager.websocketentity.onerror=function(){},window.tvmanager.websocketentity.onopen=function(){console.log("\u670d\u52a1\u5668\u5df2\u8fde\u63a5\uff0c\u7b49\u5f85\u7528\u6237\u8fdb\u5165")},window.tvmanager.websocketentity.onmessage=function(event){var obj=eval("("+event.data+")");if(obj.score&&(console.log("\u6536\u5230\u7528\u6237:"+obj.score.userName+"\u5206\u6570\u4e3a:"+obj.score.score),window.tvmanager.setUserScore(obj.score)),obj.roomMode&&(console.log("\u6536\u5230\u8bbe\u7f6e\u6a21\u5f0f:"+obj.roomMode),window.tvmanager.startdaojishi()),obj.addUser){console.log("\u7528\u6237:"+obj.addUser.userName+"\u52a0\u5165\u623f\u95f4");var roomnum=obj.addUser.roomNum;window.tvmanager.addUser(obj.addUser),CommonVar.getUserCountByRoom(roomnum,window.tvmanager.getUserCountByRoomComplete)}if(obj.removeUser){console.log("\u7528\u6237:"+obj.removeUser.userName+"\u79bb\u5f00\u623f\u95f4");var _roomnum=obj.removeUser.roomNum;CommonVar.getUserCountByRoom(_roomnum,window.tvmanager.getUserCountByRoomComplete),window.tvmanager.removeUser(obj.removeUser)}},window.tvmanager.websocketentity.onclose=function(){},window.onbeforeunload=function(){this.closeWebSocket()}},closeWebSocket:function(){window.tvmanager.websocketentity.close()},setUserScore:function(e){for(var t=0;t<this.UserGrid.length;t++)null!=this.UserGrid[t].getComponent("User").userObject&&this.UserGrid[t].getComponent("User").userObject.userName==e.userName&&this.UserGrid[t].getComponent("User").showScore(e.score)},startdaojishi:function(){window.tvmanager.waittime=20,window.tvmanager.setroommode=!0,window.tvmanager.daojishiSprite.spriteFrame=window.tvmanager.daojishiTextures[window.tvmanager.waittime],window.tvmanager.daojishiSprite.node.active=!0,window.tvmanager.schedule(window.tvmanager.jishifunction,1)},jishifunction:function(){if(window.tvmanager.waittime>=1)window.tvmanager.waittime=window.tvmanager.waittime-1,window.tvmanager.daojishiSprite.spriteFrame=window.tvmanager.daojishiTextures[window.tvmanager.waittime];else{window.tvmanager.daojishiSprite.node.active=!1,this.startgame=!0,console.log("\u5f00\u59cb\u6e38\u620f");for(var e=0;e<this.UserGrid.length;e++)null!=this.UserGrid[e].getComponent("User").userObject&&this.UserGrid[e].getComponent("User").startGame();window.tvmanager.unschedule(window.tvmanager.jishifunction)}}}),cc._RF.pop()},{commonvar:"commonvar"}],User:[function(e,t,o){"use strict";cc._RF.push(t,"12edbpihN9Im4xqzdsAgOPE","User"),cc.Class({extends:cc.Component,properties:{touxiangSprite:{default:null,type:cc.Sprite},joinSprite:{default:null,type:cc.Sprite},userName:{default:null,type:cc.Label},joinedSprite:{default:null,type:cc.SpriteFrame},startSprite:{default:null,type:cc.SpriteFrame},showsocreSprite:{default:null,type:cc.SpriteFrame},userObject:null,scoreLabel:{default:null,type:cc.Label}},initStartState:function(){this.joinSprite.node.active=!1,this.userName.string="\u672a\u52a0\u5165",this.touxiangSprite.node.active=!1,this.scoreLabel.node.active=!1},setUserInfo:function(e){this.initStartState(),this.userObject=e,this.userName.string=e.userName,this.touxiangSprite.node.active=!0,this.joinSprite.node.active=!0,console.log(e)},removeUserInfo:function(){this.userObject=null,this.userName.string="\u672a\u52a0\u5165",this.joinSprite.node.active=!1,this.touxiangSprite.node.active=!1,this.scoreLabel.node.active=!1,console.log("\u6e05\u9664\u754c\u9762\u7528\u6237\u4fe1\u606f")},startGame:function(){this.joinSprite.spriteFrame=this.startSprite},showScore:function(e){this.scoreLabel.string=e+"\u70b9",this.scoreLabel.node.active=!0,this.joinSprite.spriteFrame=this.showsocreSprite},start:function(){this.initStartState()}}),cc._RF.pop()},{}],background:[function(e,t,o){"use strict";cc._RF.push(t,"48521/TChtKYKUCSEk7D6ts","background"),cc.Class({extends:cc.Component,properties:{mobileManager:{default:null,type:cc.Node},anim:{default:null,type:cc.Animation}},start:function(){},onkcanimationend:function(){console.log("\u5f00\u573a\u52a8\u753b\u7ed3\u675f"),this.mobileManager.getComponent("mobileManager").kcend(),this.anim.play("loop")}}),cc._RF.pop()},{}],commonvar:[function(e,t,o){"use strict";cc._RF.push(t,"6b374GKw35F2ZmtabXh9qNV","commonvar");var n={basePath:"http://127.0.0.1:8080",websocketbasePath:"127.0.0.1:8080",UserList:[],sendUserLoginData:function(e,t){var o=this.basePath+"/JavaWebSocket/web/sendUserLoginData.mvc",n=new XMLHttpRequest;n.open("POST",o,!0),n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){var o=n.responseText;t(e,o)}},n.setRequestHeader("content-type","application/json"),n.send(JSON.stringify(e))},sendTVLoginData:function(e,t){var o=this.basePath+"/JavaWebSocket/web/sendUserLoginData.mvc",n=new XMLHttpRequest;n.open("POST",o,!0),n.onreadystatechange=function(){4==n.readyState&&n.status>=200&&n.status<400&&t(e)},n.setRequestHeader("content-type","application/json"),n.send(JSON.stringify(e))},getUserCountByRoom:function(e,t){var o=this.basePath+"/JavaWebSocket/web/getUserCountByRoom.mvc",n=new XMLHttpRequest;n.open("POST",o,!0),n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){var o=n.responseText;console.log("roomNum"+e),t(o)}},n.send(e)},getUrlParam:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)"),o=window.location.search.substr(1).match(t);return null!=o?unescape(o[2]):null}};t.exports=n,cc._RF.pop()},{}],mobileManager:[function(require,module,exports){"use strict";cc._RF.push(module,"77fe80aZrdAwK5AsNbHTDev","mobileManager");var CommonVar=require("commonvar");cc.Class({extends:cc.Component,properties:{ticker:0,isFPerson:!0,Buttongroup:{default:null,type:cc.Node},waitingMode:{default:null,type:cc.Node},anim:{default:null,type:cc.Animation},gameloopbg:{default:null,type:cc.Node},websocketentity:null},start:function(){window.mobilemanager=this,this.Buttongroup.active=!1,this.gameloopbg.active=!1,this.waitingMode.active=!1},selectMode:function(e,t){window.mobilemanager.setRoomMode(t)},isFirstPerson:function(){},kcend:function(){var e={},t=(new Date).valueOf();e.userName="mobile11"+t,e.roomNum=CommonVar.getUrlParam("roomNum"),e.userType="mobile",CommonVar.sendUserLoginData(e,this.ConnectWebSocket)},ConnectWebSocket:function ConnectWebSocket(udata,response){console.log(response);var obj=eval("("+response+")"),firstperson=obj.FirstPerson;window.mobilemanager.isFPerson=firstperson,"WebSocket"in window?window.mobilemanager.websocketentity=new WebSocket("ws://"+CommonVar.websocketbasePath+"/JavaWebSocket/websocket/"+udata.roomNum+"|"+udata.userName):alert("\u5f53\u524d\u6d4f\u89c8\u5668 Not support websocket"),window.mobilemanager.websocketentity.onerror=function(){},window.mobilemanager.websocketentity.onopen=function(){window.mobilemanager.getRoomMode()},window.mobilemanager.websocketentity.onmessage=function(event){var obj=eval("("+event.data+")");obj.roomMode&&(console.log("\u6536\u5230\u8bbe\u7f6e\u6a21\u5f0f:"+obj.roomMode),window.mobilemanager.startGame(obj.roomMode))},window.mobilemanager.websocketentity.onclose=function(){},window.onbeforeunload=function(){window.mobilemanager.closeWebSocket()}},startGame:function(e){""!=e?(this.waitingMode.active=!1,this.anim.node.active=!1,this.gameloopbg.active=!0,window.mobilemanager.Buttongroup.active=!1):window.mobilemanager.isFPerson?(console.log("\u8fdb\u5165\u6e38\u620f\u6a21\u5f0f\u9009\u62e9\u754c\u9762"),this.anim.node.active=!0,this.gameloopbg.active=!1,window.mobilemanager.waitingMode.active=!1,window.mobilemanager.Buttongroup.active=!0):(this.waitingMode.active=!0,console.log("\u8fdb\u5165\u6e38\u620f\u754c\u9762"),window.mobilemanager.Buttongroup.active=!1)},closeWebSocket:function(){this.websocketentity.close()},getRoomMode:function(){var e=CommonVar.basePath+"/JavaWebSocket/web/getRoomMode.mvc",t=new XMLHttpRequest;t.open("POST",e,!0),t.onreadystatechange=function(){if(4==t.readyState&&t.status>=200&&t.status<400){var e=t.responseText;window.mobilemanager.ongetRoomModesuccess(e)}},t.send(CommonVar.getUrlParam("roomNum"))},ongetRoomModesuccess:function(e){this.startGame(e)},setRoomMode:function(e){var t={};t.roomMode=e,t.roomNum=CommonVar.getUrlParam("roomNum");var o=CommonVar.basePath+"/JavaWebSocket/web/setRoomMode.mvc",n=new XMLHttpRequest;n.open("POST",o,!0),n.onreadystatechange=function(){if(4==n.readyState&&n.status>=200&&n.status<400){var e=n.responseText;window.mobilemanager.onsetRoomModesuccess(e)}},n.setRequestHeader("content-type","application/json"),n.send(JSON.stringify(t))},onsetRoomModesuccess:function(e){e&&(console.log("\u6a21\u5f0f\u8bbe\u7f6e\u5b8c\u6210\uff0conmessage\u6536\u5230\u6d88\u606f\u4f1a\u6267\u884c\u5173\u95ed\u7b49\u5f85\u9875\u9762\uff0c\u8fdb\u5165\u6e38\u620f\u9875\u9762"),this.Buttongroup.active=!1)}}),cc._RF.pop()},{commonvar:"commonvar"}],motion1:[function(e,t,o){"use strict";cc._RF.push(t,"67df2R6aBpMPZXY0fPbsqcZ","motion1"),cc.Class({extends:cc.Component,properties:{},onLoad:function(){cc.systemEvent.setAccelerometerEnabled(!0),cc.systemEvent.on(cc.SystemEvent.EventType.DEVICEMOTION,this.onDeviceMotionEvent,this)},onKeyDown:function(e){switch(e.keyCode){case cc.macro.KEY.a:console.log("Press a key")}},onKeyUp:function(e){switch(e.keyCode){case cc.macro.KEY.a:console.log("release a key")}},onDestroy:function(){cc.systemEvent.off(cc.SystemEvent.EventType.DEVICEMOTION,this.onDeviceMotionEvent,this)},onDeviceMotionEvent:function(e){cc.log("event name:",e.type," acc x:",e.acc.x," acc y:",e.acc.y," acc z:",e.acc.z)},onTouchMove:function(e){cc.log("event name:",e.type,"start point:",e.currentTouch._startPoint," current point:",e.currentTouch._point)},start:function(){}}),cc._RF.pop()},{}],motion:[function(e,t,o){"use strict";cc._RF.push(t,"9e1aeb3A41CFJCtfvb/r8b1","motion");var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};cc.Class({extends:cc.Component,properties:{},onLoad:function(){window.DeviceOrientationEvent.requestPermission().then(function(e){"granted"===e?console.error("\u7528\u6237\u5141\u8bb8",e):"denied"===e?console.error("\u7528\u6237\u62d2\u7edd",e):"prompt"===e&&console.error("\u7528\u6237\u5e72\u4e86\u5565",e)})},onDeviceMotionEvent:function(e){cc.log("event name:",e.type," acc x:",e.acc.x," acc y:",e.acc.y," acc z:",e.acc.z)},getPermission:function(){"function"==typeof DeviceOrientationEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(function(e){console.log(e)}).catch(function(e){console.log(e)}):console.log("undefined"==typeof DeviceOrientationEvent?"undefined":n(DeviceOrientationEvent))},permission:function(){"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceMotionEvent.requestPermission().then(function(e){console.log(e),"granted"==e&&window.addEventListener("devicemotion",function(e){})}).catch(console.error):alert("DeviceMotionEvent is not defined")},start:function(){}}),cc._RF.pop()},{}],shouye:[function(e,t,o){"use strict";cc._RF.push(t,"29cf0nQUydO3ZyUo5yYZ2Pz","shouye");var n,i=e("commonvar");cc.Class({extends:cc.Component,properties:{ewmSprite:{default:null,type:cc.Sprite}},start:function(){(n=this).getEwm()},getEwm:function(){var e=i.getUrlParam("roomNum"),t={};t.url=i.basePath+"/JavaWebSocket/html/websocket.html?roomNum="+e;var o=i.basePath+"/JavaWebSocket/qrCode/getqrCode.mvc",r=new XMLHttpRequest;r.open("POST",o,!0),r.onreadystatechange=function(){if(4==r.readyState&&r.status>=200&&r.status<400){var e=r.responseText;n.getEwmOnsuccess(e)}},r.setRequestHeader("content-type","application/json"),r.send(JSON.stringify(t))},getEwmOnsuccess:function(e){console.log(e);var t="data:image/jpeg;base64,"+e,o=new Image;o.src=t;var n=new cc.Texture2D;n.initWithElement(o),n.handleLoadedTexture(),this.ewmSprite.spriteFrame=new cc.SpriteFrame(n)}}),cc._RF.pop()},{commonvar:"commonvar"}]},{},["TVManager","User","commonvar","background","mobileManager","motion","shouye","motion1"]);